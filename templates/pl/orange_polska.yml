# Szablon dla faktur Orange Polska
issuer: "Orange Polska"
description: "Szablon zoptymalizowany dla faktur od Orange Polska S.A."
language: "Polski"
priority: 80  # Wysoki priorytet - specyficzny szablon

keywords:
  - "ORANGE"
  - "ORANGE POLSKA"
  - "TELEKOMUNIKACJA"
  - "5271024901"  # NIP Orange

exclude_keywords:
  - "ORANGE ROMANIA"
  - "ORANGE FRANCE"

fields:
  invoice_id:
    parser: regex
    patterns:
      - 'Numer faktury[:\s]*([A-Z0-9/\-]+)'
      - 'Nr dokumentu[:\s]*([A-Z0-9/\-]+)'
      - 'Faktura nr[:\s]*([0-9]+/[0-9]+/[0-9]+)'
    group: 1
    required: true

  invoice_type:
    parser: keyword_detection
    mapping:
      "KOREKTA": "KOREKTA"
      "FAKTURA KORYGUJĄCA": "KOREKTA"
    default: "VAT"

  issue_date:
    parser: date
    keywords:
      - "Data wystawienia"
      - "Wystawiono"
    patterns:
      - '\d{2}\.\d{2}\.\d{4}'
    formats:
      - '%d.%m.%Y'
    required: true

  sale_date:
    parser: date
    keywords:
      - "Okres rozliczeniowy"
      - "Za okres"
    patterns:
      - '\d{2}\.\d{2}\.\d{4}'
    formats:
      - '%d.%m.%Y'
    fallback: "use_issue_date"

  due_date:
    parser: date
    keywords:
      - "Termin płatności"
      - "Zapłać do"
    patterns:
      - '\d{2}\.\d{2}\.\d{4}'
    formats:
      - '%d.%m.%Y'
    required: true

  supplier_name:
    parser: static
    value: "Orange Polska S.A."

  supplier_tax_id:
    parser: static
    value: "5271024901"

  supplier_address:
    parser: static
    value: "Al. Jerozolimskie 160, 02-326 Warszawa"

  supplier_accounts:
    parser: bank_accounts
    patterns:
      - '(?:PL\s?)?\d{2}\s?\d{4}\s?\d{4}\s?\d{4}\s?\d{4}\s?\d{4}\s?\d{4}'
    validator: iban
    multiple: true

  buyer_name:
    parser: context_extraction
    keywords:
      - "Nabywca"
      - "Klient"
      - "Dane klienta"
    extraction_strategy: "next_line"
    required: true

  buyer_tax_id:
    parser: regex
    patterns:
      - 'NIP[:\s]*(\d{3}[-\s]?\d{3}[-\s]?\d{2}[-\s]?\d{2})'
      - 'NIP[:\s]*(\d{10})'
    validator: nip
    group: 1
    context_keywords:
      - "Nabywca"
      - "Klient"
    context_range: 400

  buyer_address:
    parser: address_extraction
    context_keywords:
      - "Nabywca"
    patterns:
      - '(\d{2}-\d{3}\s+[A-ZĄŻŹĆŃŁÓĘŚ][a-zążźćńłóęś]+)'
    context_range: 500

  total_gross:
    parser: money
    keywords:
      - "DO ZAPŁATY"
      - "Kwota do zapłaty"
      - "Razem do zapłaty"
      - "SUMA"
    patterns:
      - '(\d{1,3}(?:\s\d{3})*(?:,\d{2}))\s*(?:zł|PLN)'
    currency: "PLN"
    required: true

  total_net:
    parser: money
    keywords:
      - "Wartość netto"
      - "NETTO"
    patterns:
      - '(\d{1,3}(?:\s\d{3})*(?:,\d{2}))\s*(?:zł|PLN)?'
    currency: "PLN"
    fallback: "calculate_from_gross:23"

  total_vat:
    parser: money
    keywords:
      - "Kwota VAT"
      - "VAT"
    patterns:
      - '(\d{1,3}(?:\s\d{3})*(?:,\d{2}))\s*(?:zł|PLN)?'
    currency: "PLN"
    fallback: "calculate_difference"

  currency:
    parser: static
    value: "PLN"

lines:
  enabled: true
  start:
    patterns:
      - 'Usługi telekomunikacyjne'
      - 'Szczegóły faktury'
  end:
    patterns:
      - 'Razem|RAZEM|Suma'
  line_pattern: '(.+?)\s+(\d+(?:,\d{2})?)\s+zł'
  line_fields:
    - name: description
      group: 1
      type: string
    - name: total
      group: 2
      type: decimal

options:
  remove_whitespace: true
  date_tolerance_days: 365
  amount_tolerance: 0.02
  tax_id_assignment_strategy: "context_proximity"
  validate_iban: true
  debug_mode: false

metadata:
  author: "System"
  version: "1.0"
  created: "2025-11-29"
  notes: "Szablon dla faktur telekomunikacyjnych Orange Polska"
