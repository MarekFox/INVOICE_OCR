# Universal template for English invoices
issuer: "Generic English Template"
description: "Default template for English language invoices"
language: "Angielski"
priority: 1

keywords:
  - "INVOICE"
  - "BILL"
  - "VAT"
  - "TAX ID"
  - "SELLER"
  - "BUYER"

exclude_keywords: []

fields:
  invoice_id:
    parser: regex
    patterns:
      - 'Invoice\s*(?:No|#|Number)[:\s]*([A-Z0-9][A-Z0-9/\-\.]+)'
      - 'INV[-\s]?([0-9]+)'
      - 'Bill\s*(?:No|#)[:\s]*([A-Z0-9/\-\.]+)'
    group: 1
    required: true

  invoice_type:
    parser: keyword_detection
    mapping:
      "CREDIT NOTE": "KOREKTA"
      "CREDIT MEMO": "KOREKTA"
      "PROFORMA": "PROFORMA"
      "ADVANCE": "ZALICZKOWA"
      "DEPOSIT": "ZALICZKOWA"
    default: "VAT"

  issue_date:
    parser: date
    keywords:
      - "INVOICE DATE"
      - "DATE"
      - "ISSUE DATE"
    patterns:
      - '\d{2}/\d{2}/\d{4}'
      - '\d{4}-\d{2}-\d{2}'
      - '\d{2}-\d{2}-\d{4}'
    formats:
      - '%m/%d/%Y'
      - '%d/%m/%Y'
      - '%Y-%m-%d'
    search_range: 150
    required: true

  sale_date:
    parser: date
    keywords:
      - "DELIVERY DATE"
      - "SERVICE DATE"
      - "SHIP DATE"
    patterns:
      - '\d{2}/\d{2}/\d{4}'
    formats:
      - '%m/%d/%Y'
    fallback: "use_issue_date"

  due_date:
    parser: date
    keywords:
      - "DUE DATE"
      - "PAYMENT DUE"
      - "PAY BY"
    patterns:
      - '\d{2}/\d{2}/\d{4}'
    formats:
      - '%m/%d/%Y'
    fallback: "add_days:30"

  supplier_name:
    parser: context_extraction
    keywords:
      - "FROM"
      - "SELLER"
      - "VENDOR"
      - "BILLER"
    extraction_strategy: "next_line"
    fallback: "NOT_FOUND"
    required: true

  supplier_tax_id:
    parser: regex
    patterns:
      - '(?:VAT|Tax\s*ID)[:\s]*([A-Z]{2}\s?\d+)'
      - 'EIN[:\s]*(\d{2}-\d{7})'
      - 'GST[:\s]*([A-Z0-9]+)'
    group: 1
    context_keywords:
      - "FROM"
      - "SELLER"
    context_range: 300

  supplier_address:
    parser: address_extraction
    context_keywords:
      - "FROM"
      - "SELLER"
    patterns:
      - '([A-Z][a-z]+,?\s+[A-Z]{2}\s+\d{5}(?:-\d{4})?)'
    context_range: 400

  supplier_accounts:
    parser: bank_accounts
    patterns:
      - '[A-Z]{2}\d{2}\s?[A-Z0-9]{4}\s?\d{4}\s?\d{4}\s?\d{4}(?:\s?\d{0,4})?'
      - 'Account[:\s]*(\d{8,17})'
    validator: iban
    multiple: true

  buyer_name:
    parser: context_extraction
    keywords:
      - "BILL TO"
      - "TO"
      - "BUYER"
      - "CUSTOMER"
    extraction_strategy: "next_line"
    fallback: "NOT_FOUND"
    required: true

  buyer_tax_id:
    parser: regex
    patterns:
      - '(?:VAT|Tax\s*ID)[:\s]*([A-Z]{2}\s?\d+)'
      - 'EIN[:\s]*(\d{2}-\d{7})'
    group: 1
    context_keywords:
      - "BILL TO"
      - "BUYER"
    context_range: 300

  total_gross:
    parser: money
    keywords:
      - "TOTAL"
      - "GRAND TOTAL"
      - "AMOUNT DUE"
      - "BALANCE DUE"
    patterns:
      - '(\d{1,3}(?:,\d{3})*(?:\.\d{2})?)\s*(?:\$|USD|GBP|EUR)'
      - '(?:\$|USD|GBP|EUR)\s*(\d{1,3}(?:,\d{3})*(?:\.\d{2})?)'
    currency: "USD"
    decimal_separator: "."
    thousand_separator: ","
    required: true

  total_net:
    parser: money
    keywords:
      - "SUBTOTAL"
      - "NET"
    patterns:
      - '(\d{1,3}(?:,\d{3})*(?:\.\d{2})?)\s*(?:\$|USD)?'
    currency: "USD"
    fallback: "calculate_from_gross:20"

  total_vat:
    parser: money
    keywords:
      - "TAX"
      - "VAT"
      - "GST"
    patterns:
      - '(\d{1,3}(?:,\d{3})*(?:\.\d{2})?)\s*(?:\$|USD)?'
    currency: "USD"
    fallback: "calculate_difference"

  currency:
    parser: keyword_detection
    mapping:
      "$": "USD"
      "USD": "USD"
      "£": "GBP"
      "GBP": "GBP"
      "€": "EUR"
      "EUR": "EUR"
    default: "USD"

lines:
  enabled: true
  start:
    patterns:
      - 'No\.|Item|#'
      - 'Description.*Qty.*Price'
  end:
    patterns:
      - 'Subtotal|SUBTOTAL|Total|TOTAL'
  line_pattern: '^(\d+)\s+(.+?)\s+([\d,\.]+)\s+([\d,\.]+)\s+([\d,\.]+)$'
  line_fields:
    - name: position
      group: 1
      type: int
    - name: description
      group: 2
      type: string
    - name: quantity
      group: 3
      type: decimal
    - name: price_unit
      group: 4
      type: decimal
    - name: total
      group: 5
      type: decimal
  skip_lines:
    patterns:
      - 'Page \d+ of \d+'

options:
  remove_whitespace: true
  date_tolerance_days: 365
  amount_tolerance: 0.02
  tax_id_assignment_strategy: "context_proximity"
  validate_iban: true
  debug_mode: false

metadata:
  author: "System"
  version: "1.0"
  created: "2025-11-29"
